"use strict";var u=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var f=Object.prototype.hasOwnProperty;var P=(s,e)=>{for(var t in e)u(s,t,{get:e[t],enumerable:!0})},q=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of F(e))!f.call(s,r)&&r!==t&&u(s,r,{get:()=>e[r],enumerable:!(n=_(e,r))||n.enumerable});return s};var C=s=>q(u({},"__esModule",{value:!0}),s);var L={};P(L,{Ticker:()=>p,createRequestFrame:()=>c,createXrRequestFrame:()=>g});module.exports=C(L);var l=require("eventti");function c(s=60){if(typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function")return e=>{let t=requestAnimationFrame(e);return()=>cancelAnimationFrame(t)};{let e=1e3/s,t=typeof performance>"u"?()=>Date.now():()=>performance.now();return n=>{let r=setTimeout(()=>n(t()),e);return()=>clearTimeout(r)}}}var p=class{constructor(e={}){let{phases:t=[],paused:n=!1,onDemand:r=!1,requestFrame:h=c(),dedupe:a,getId:o}=e;this._phases=t,this._emitter=new l.Emitter({getId:o,dedupe:a}),this._paused=n,this._onDemand=r,this._requestFrame=h,this._cancelFrame=null,this._empty=!0,this._queue=[],this.tick=this.tick.bind(this),this._getListeners=this._emitter._getListeners.bind(this._emitter)}get phases(){return this._phases}set phases(e){this._phases=e,this._empty=!e.length}get requestFrame(){return this._requestFrame}set requestFrame(e){this._requestFrame=e,this._cancelFrame&&(this._cancel(),this._request())}get paused(){return this._paused}set paused(e){this._paused=e,e?this._cancel():this._request()}get onDemand(){return this._paused}set onDemand(e){this._onDemand=e,e||this._request()}get dedupe(){return this._emitter.dedupe}set dedupe(e){this._emitter.dedupe=e}get getId(){return this._emitter.getId}set getId(e){this._emitter.getId=e}tick(...e){let{_queue:t,_onDemand:n}=this;if(t.length)throw new Error("Ticker: Can't tick before the previous tick has finished!");if(this._cancelFrame=null,n||this._request(),this._empty)return;let{phases:r,_getListeners:h}=this,a=0,o=r.length,i;for(;a<o;a++)i=h(r[a]),i&&t.push(i);if(!t.length){this._empty=!0;return}n&&this._request();let m,d;for(a=0,o=t.length;a<o;a++)for(i=t[a],m=0,d=i.length;m<d;m++)i[m](...e);t.length=0}on(e,t,n){let r=this._emitter.on(e,t,n);return this._empty=!1,this._onDemand&&this._request(),r}once(e,t,n){let r=this._emitter.once(e,t,n);return this._empty=!1,this._onDemand&&this._request(),r}off(e,t){return this._emitter.off(e,t)}listenerCount(e){return this._emitter.listenerCount(e)}_request(){this._paused||this._cancelFrame||(this._cancelFrame=this._requestFrame(this.tick))}_cancel(){this._cancelFrame&&(this._cancelFrame(),this._cancelFrame=null)}};function g(s){return e=>{let t=s.requestAnimationFrame(e);return()=>s.cancelAnimationFrame(t)}}0&&(module.exports={Ticker,createRequestFrame,createXrRequestFrame});
