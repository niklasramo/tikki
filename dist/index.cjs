"use strict";var u=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var f=Object.prototype.hasOwnProperty;var q=(s,e)=>{for(var t in e)u(s,t,{get:e[t],enumerable:!0})},b=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of C(e))!f.call(s,i)&&i!==t&&u(s,i,{get:()=>e[i],enumerable:!(r=k(e,i))||r.enumerable});return s};var g=s=>b(u({},"__esModule",{value:!0}),s);var P={};q(P,{TickMode:()=>p,Ticker:()=>h,createRequestFrame:()=>d,createXrRequestFrame:()=>E});module.exports=g(P);var _=require("eventti");function d(s=60){if(typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function")return e=>{let t=requestAnimationFrame(e);return()=>cancelAnimationFrame(t)};{let e=1e3/s,t=typeof performance>"u"?()=>Date.now():()=>performance.now();return r=>{let i=setTimeout(()=>r(t()),e);return()=>clearTimeout(i)}}}var p=(r=>(r[r.PAUSED=1]="PAUSED",r[r.ON_DEMAND=2]="ON_DEMAND",r[r.CONTINUOUS=3]="CONTINUOUS",r))(p||{}),h=class{constructor(e={}){let{phases:t=[],tickMode:r=2,requestFrame:i=d(),dedupe:m,getId:a}=e;this.phases=t,this._emitter=new _.Emitter({getId:a,dedupe:m}),this._tickMode=r,this._requestFrame=i,this._cancelFrame=null,this._queue=[],this.tick=this.tick.bind(this),this._getListeners=this._emitter._getListeners.bind(this._emitter)}get requestFrame(){return this._requestFrame}set requestFrame(e){this._requestFrame=e,this._kickstart()}get tickMode(){return this._tickMode}set tickMode(e){this._tickMode=e,this._kickstart()}get dedupe(){return this._emitter.dedupe}set dedupe(e){this._emitter.dedupe=e}get getId(){return this._emitter.getId}set getId(e){this._emitter.getId=e}tick(...e){let{_queue:t}=this;if(t.length)throw new Error("Ticker: Can't tick before the previous tick has finished!");this._cancelFrame=null,this._request();let{phases:r,_emitter:i,_getListeners:m}=this,a,n,o,F,c,l;for(a=0,o=r.length;a<o;a++)l=m(r[a]),l&&t.push(l);for(a=0,o=t.length;a<o;a++)for(c=t[a],n=0,F=c.length;n<F;n++)c[n](...e);t.length=0,this._tickMode===2&&!i.listenerCount()&&this._cancel()}on(e,t,r){let i=this._emitter.on(e,t,r);return this._request(),i}once(e,t,r){let i=this._emitter.once(e,t,r);return this._request(),i}off(e,t){return this._emitter.off(e,t)}listenerCount(e){return this._emitter.listenerCount(e)}_request(){this._requestFrame&&!this._cancelFrame&&this._tickMode>=2&&(this._cancelFrame=this._requestFrame(this.tick))}_cancel(){this._cancelFrame&&(this._cancelFrame(),this._cancelFrame=null)}_kickstart(){this._tickMode===2?this._emitter.listenerCount()&&this._request():this._tickMode===3?this._request():this._cancel()}};function E(s){return e=>{let t=s.requestAnimationFrame(e);return()=>s.cancelAnimationFrame(t)}}0&&(module.exports={TickMode,Ticker,createRequestFrame,createXrRequestFrame});
