"use strict";var m=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var C=(a,e)=>{for(var t in e)m(a,t,{get:e[t],enumerable:!0})},k=(a,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of F(e))!_.call(a,r)&&r!==t&&m(a,r,{get:()=>e[r],enumerable:!(s=d(e,r))||s.enumerable});return a};var b=a=>k(m({},"__esModule",{value:!0}),a);var T={};C(T,{AutoTicker:()=>h,Clock:()=>p,Ticker:()=>o,TickerDedupe:()=>f,createRequestFrame:()=>u,createXrRequestFrame:()=>q});module.exports=b(T);var l=require("eventti"),f=l.EmitterDedupe,o=class{constructor(e={}){let{phases:t=[],dedupe:s,getId:r}=e;this._phases=t,this._emitter=new l.Emitter({getId:r,dedupe:s}),this._queue=[],this.tick=this.tick.bind(this),this._getListeners=this._emitter._getListeners.bind(this._emitter)}get phases(){return this._phases}set phases(e){this._phases=e}get dedupe(){return this._emitter.dedupe}set dedupe(e){this._emitter.dedupe=e}get getId(){return this._emitter.getId}set getId(e){this._emitter.getId=e}tick(...e){this._assertEmptyQueue(),this._fillQueue(),this._processQueue(...e)}on(e,t,s){return this._emitter.on(e,t,s)}once(e,t,s){return this._emitter.once(e,t,s)}off(e,t){return this._emitter.off(e,t)}count(e){return this._emitter.listenerCount(e)}_assertEmptyQueue(){if(this._queue.length)throw new Error("Ticker: Can't tick before the previous tick has finished!")}_fillQueue(){let{_queue:e,_phases:t,_getListeners:s}=this,r=0,n=t.length,i;for(;r<n;r++)i=s(t[r]),i&&e.push(i);return e}_processQueue(...e){let{_queue:t}=this;if(t.length){let s=0,r=0,n=t.length,i,c;for(;s<n;s++)for(c=t[s],r=0,i=c.length;r<i;r++)c[r](...e);t.length=0}}};function u(a=60){if(typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function")return e=>{let t=requestAnimationFrame(e);return()=>cancelAnimationFrame(t)};{let e=1e3/a,t=typeof performance>"u"?()=>Date.now():()=>performance.now();return s=>{let r=setTimeout(()=>s(t()),e);return()=>clearTimeout(r)}}}var h=class extends o{constructor(e={}){let{paused:t=!1,onDemand:s=!1,requestFrame:r=u(),...n}=e;super(n),this._paused=t,this._onDemand=s,this._requestFrame=r,this._cancelFrame=null,this._empty=!0,!t&&!s&&this._request()}get phases(){return this._phases}set phases(e){this._phases=e,e.length?(this._empty=!1,this._request()):this._empty=!0}get paused(){return this._paused}set paused(e){this._paused=e,e?this._cancel():this._request()}get onDemand(){return this._paused}set onDemand(e){this._onDemand=e,e||this._request()}get requestFrame(){return this._requestFrame}set requestFrame(e){this._requestFrame!==e&&(this._requestFrame=e,this._cancelFrame&&(this._cancel(),this._request()))}tick(...e){if(this._assertEmptyQueue(),this._cancelFrame=null,this._onDemand||this._request(),!this._empty){if(this._fillQueue(),!this._queue.length){this._empty=!0;return}this._onDemand&&this._request(),this._processQueue(...e)}}on(e,t,s){let r=super.on(e,t,s);return this._empty=!1,this._request(),r}once(e,t,s){let r=super.once(e,t,s);return this._empty=!1,this._request(),r}_request(){this._paused||this._cancelFrame||(this._cancelFrame=this._requestFrame(this.tick))}_cancel(){this._cancelFrame&&(this._cancelFrame(),this._cancelFrame=null)}};var p=class{constructor(){this.ticks=0,this.time=0,this.startTime=0,this.elapsedTime=0,this.deltaTime=0,this.timescale=1}tick(e,t){this.ticks?(this.deltaTime=(t===void 0?e-this.time:t)*this.timescale,this.elapsedTime+=this.deltaTime,this.time=e):(this.startTime=e,this.time=e,this.deltaTime=(t||0)*this.timescale,this.elapsedTime+=this.deltaTime),++this.ticks}};function q(a){return e=>{let t=a.requestAnimationFrame(e);return()=>a.cancelAnimationFrame(t)}}0&&(module.exports={AutoTicker,Clock,Ticker,TickerDedupe,createRequestFrame,createXrRequestFrame});
