import{Emitter}from"eventti";const{r:DEFAULT_REQUEST_TICK,c:DEFAULT_CANCEL_TICK}=(()=>{if("function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame)return{r:t=>requestAnimationFrame(t),c:t=>cancelAnimationFrame(t)};{const t=1e3/60,e="undefined"==typeof performance?()=>Date.now():()=>performance.now();return{r:i=>setTimeout((()=>i(e())),t),c:t=>clearTimeout(t)}}})();var AutoTickState;!function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON",t[t.PAUSED=2]="PAUSED"}(AutoTickState||(AutoTickState={}));class Ticker{constructor(t={}){const{phases:e=[],autoTick:i=AutoTickState.ON,allowDuplicateListeners:s=!0,idDedupeMode:r="replace",requestTick:c=DEFAULT_REQUEST_TICK,cancelTick:n=DEFAULT_CANCEL_TICK}=t;this.phases=e,this.allowDuplicateListeners=s,this._autoTick=i,this._autoTickId=null,this._requestTick=c,this._cancelTick=n,this._emitter=new Emitter({allowDuplicateListeners:s,idDedupeMode:r}),this._queue=[],this.tick=this.tick.bind(this)}get autoTick(){return this._autoTick}set autoTick(t){t===AutoTickState.ON?this._emitter.listenerCount()&&this._requestFrame():this._cancelFrame(),this._autoTick=t}get idDedupeMode(){return this._emitter.idDedupeMode}set idDedupeMode(t){this._emitter.idDedupeMode=t}tick(t){this._autoTickId=null;const{_queue:e}=this;if(e.length)throw new Error("Can't tick before the previous tick has finished.");this._requestFrame();const{phases:i,_emitter:s}=this;let r,c,n,o,u,a;for(r=0,n=i.length;r<n;r++)a=s._getListeners(i[r]),a&&e.push(a);for(r=0,n=e.length;r<n;r++)for(u=e[r],c=0,o=u.length;c<o;c++)u[c](t);e.length=0,null===this._autoTickId||s.listenerCount()||this._cancelFrame()}on(t,e,i){const s=this._emitter.on(t,e,i);return this._requestFrame(),s}once(t,e,i){const s=this._emitter.once(t,e,i);return this._requestFrame(),s}off(t,e){return this._emitter.off(t,e)}listenerCount(t){return this._emitter.listenerCount(t)}_requestFrame(){this._autoTick===AutoTickState.ON&&null===this._autoTickId&&(this._autoTickId=this._requestTick(this.tick))}_cancelFrame(){null!==this._autoTickId&&(this._cancelTick(this._autoTickId),this._autoTickId=null)}}export{AutoTickState,Ticker};