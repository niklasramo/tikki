import{Emitter as d}from"eventti";function c(i=60){if(typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function")return e=>{let t=requestAnimationFrame(e);return()=>cancelAnimationFrame(t)};{let e=1e3/i,t=typeof performance>"u"?()=>Date.now():()=>performance.now();return r=>{let s=setTimeout(()=>r(t()),e);return()=>clearTimeout(s)}}}var p=class{constructor(e={}){let{phases:t=[],paused:r=!1,onDemand:s=!1,requestFrame:h=c(),dedupe:n,getId:o}=e;this._phases=t,this._emitter=new d({getId:o,dedupe:n}),this._paused=r,this._onDemand=s,this._requestFrame=h,this._cancelFrame=null,this._empty=!0,this._queue=[],this.tick=this.tick.bind(this),this._getListeners=this._emitter._getListeners.bind(this._emitter)}get phases(){return this._phases}set phases(e){this._phases=e,this._empty=!e.length}get requestFrame(){return this._requestFrame}set requestFrame(e){this._requestFrame=e,this._cancelFrame&&(this._cancel(),this._request())}get paused(){return this._paused}set paused(e){this._paused=e,e?this._cancel():this._request()}get onDemand(){return this._paused}set onDemand(e){this._onDemand=e,e||this._request()}get dedupe(){return this._emitter.dedupe}set dedupe(e){this._emitter.dedupe=e}get getId(){return this._emitter.getId}set getId(e){this._emitter.getId=e}tick(...e){let{_queue:t,_onDemand:r}=this;if(t.length)throw new Error("Ticker: Can't tick before the previous tick has finished!");if(this._cancelFrame=null,r||this._request(),this._empty)return;let{phases:s,_getListeners:h}=this,n=0,o=s.length,a;for(;n<o;n++)a=h(s[n]),a&&t.push(a);if(!t.length){this._empty=!0;return}r&&this._request();let m,u;for(n=0,o=t.length;n<o;n++)for(a=t[n],m=0,u=a.length;m<u;m++)a[m](...e);t.length=0}on(e,t,r){let s=this._emitter.on(e,t,r);return this._empty=!1,this._onDemand&&this._request(),s}once(e,t,r){let s=this._emitter.once(e,t,r);return this._empty=!1,this._onDemand&&this._request(),s}off(e,t){return this._emitter.off(e,t)}listenerCount(e){return this._emitter.listenerCount(e)}_request(){this._paused||this._cancelFrame||(this._cancelFrame=this._requestFrame(this.tick))}_cancel(){this._cancelFrame&&(this._cancelFrame(),this._cancelFrame=null)}};function L(i){return e=>{let t=i.requestAnimationFrame(e);return()=>i.cancelAnimationFrame(t)}}export{p as Ticker,c as createRequestFrame,L as createXrRequestFrame};
