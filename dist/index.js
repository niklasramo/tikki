import{Emitter as h,EmitterDedupe as p}from"eventti";var C=p,o=class{constructor(e={}){let{phases:t=[],dedupe:r,getId:s}=e;this._phases=t,this._emitter=new h({getId:s,dedupe:r}),this._queue=[],this.tick=this.tick.bind(this),this._getListeners=this._emitter._getListeners.bind(this._emitter)}get phases(){return this._phases}set phases(e){this._phases=e}get dedupe(){return this._emitter.dedupe}set dedupe(e){this._emitter.dedupe=e}get getId(){return this._emitter.getId}set getId(e){this._emitter.getId=e}tick(...e){this._assertEmptyQueue(),this._fillQueue(),this._processQueue(...e)}on(e,t,r){return this._emitter.on(e,t,r)}once(e,t,r){return this._emitter.once(e,t,r)}off(e,t){return this._emitter.off(e,t)}count(e){return this._emitter.listenerCount(e)}_assertEmptyQueue(){if(this._queue.length)throw new Error("Ticker: Can't tick before the previous tick has finished!")}_fillQueue(){let{_queue:e,_phases:t,_getListeners:r}=this,s=0,n=t.length,i;for(;s<n;s++)i=r(t[s]),i&&e.push(i);return e}_processQueue(...e){let{_queue:t}=this;if(t.length){let r=0,s=0,n=t.length,i,l;for(;r<n;r++)for(l=t[r],s=0,i=l.length;s<i;s++)l[s](...e);t.length=0}}};function c(a=60){if(typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function")return e=>{let t=requestAnimationFrame(e);return()=>cancelAnimationFrame(t)};{let e=1e3/a,t=typeof performance>"u"?()=>Date.now():()=>performance.now();return r=>{let s=setTimeout(()=>r(t()),e);return()=>clearTimeout(s)}}}var m=class extends o{constructor(e={}){let{paused:t=!1,onDemand:r=!1,requestFrame:s=c(),...n}=e;super(n),this._paused=t,this._onDemand=r,this._requestFrame=s,this._cancelFrame=null,this._empty=!0,!t&&!r&&this._request()}get phases(){return this._phases}set phases(e){this._phases=e,e.length?(this._empty=!1,this._request()):this._empty=!0}get paused(){return this._paused}set paused(e){this._paused=e,e?this._cancel():this._request()}get onDemand(){return this._paused}set onDemand(e){this._onDemand=e,e||this._request()}get requestFrame(){return this._requestFrame}set requestFrame(e){this._requestFrame!==e&&(this._requestFrame=e,this._cancelFrame&&(this._cancel(),this._request()))}tick(...e){if(this._assertEmptyQueue(),this._cancelFrame=null,this._onDemand||this._request(),!this._empty){if(this._fillQueue(),!this._queue.length){this._empty=!0;return}this._onDemand&&this._request(),this._processQueue(...e)}}on(e,t,r){let s=super.on(e,t,r);return this._empty=!1,this._request(),s}once(e,t,r){let s=super.once(e,t,r);return this._empty=!1,this._request(),s}_request(){this._paused||this._cancelFrame||(this._cancelFrame=this._requestFrame(this.tick))}_cancel(){this._cancelFrame&&(this._cancelFrame(),this._cancelFrame=null)}};var u=class{constructor(){this.ticks=0,this.time=0,this.startTime=0,this.elapsedTime=0,this.deltaTime=0,this.timescale=1}tick(e,t){this.ticks?(this.deltaTime=(t===void 0?e-this.time:t)*this.timescale,this.elapsedTime+=this.deltaTime,this.time=e):(this.startTime=e,this.time=e,this.deltaTime=(t||0)*this.timescale,this.elapsedTime+=this.deltaTime),++this.ticks}};function D(a){return e=>{let t=a.requestAnimationFrame(e);return()=>a.cancelAnimationFrame(t)}}export{m as AutoTicker,u as Clock,o as Ticker,C as TickerDedupe,c as createRequestFrame,D as createXrRequestFrame};
