import{Emitter as F}from"eventti";function d(a=60){if(typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function")return e=>{let t=requestAnimationFrame(e);return()=>cancelAnimationFrame(t)};{let e=1e3/a,t=typeof performance>"u"?()=>Date.now():()=>performance.now();return r=>{let s=setTimeout(()=>r(t()),e);return()=>clearTimeout(s)}}}var _=(r=>(r[r.PAUSED=1]="PAUSED",r[r.ON_DEMAND=2]="ON_DEMAND",r[r.CONTINUOUS=3]="CONTINUOUS",r))(_||{}),h=class{constructor(e={}){let{phases:t=[],tickMode:r=2,requestFrame:s=d(),dedupe:m,getId:i}=e;this.phases=t,this._emitter=new F({getId:i,dedupe:m}),this._tickMode=r,this._requestFrame=s,this._cancelFrame=null,this._queue=[],this.tick=this.tick.bind(this),this._getListeners=this._emitter._getListeners.bind(this._emitter)}get requestFrame(){return this._requestFrame}set requestFrame(e){this._requestFrame=e,this._kickstart()}get tickMode(){return this._tickMode}set tickMode(e){this._tickMode=e,this._kickstart()}get dedupe(){return this._emitter.dedupe}set dedupe(e){this._emitter.dedupe=e}get getId(){return this._emitter.getId}set getId(e){this._emitter.getId=e}tick(...e){let{_queue:t}=this;if(t.length)throw new Error("Ticker: Can't tick before the previous tick has finished!");this._cancelFrame=null,this._request();let{phases:r,_emitter:s,_getListeners:m}=this,i,n,o,u,c,l;for(i=0,o=r.length;i<o;i++)l=m(r[i]),l&&t.push(l);for(i=0,o=t.length;i<o;i++)for(c=t[i],n=0,u=c.length;n<u;n++)c[n](...e);t.length=0,this._tickMode===2&&!s.listenerCount()&&this._cancel()}on(e,t,r){let s=this._emitter.on(e,t,r);return this._request(),s}once(e,t,r){let s=this._emitter.once(e,t,r);return this._request(),s}off(e,t){return this._emitter.off(e,t)}listenerCount(e){return this._emitter.listenerCount(e)}_request(){this._requestFrame&&!this._cancelFrame&&this._tickMode>=2&&(this._cancelFrame=this._requestFrame(this.tick))}_cancel(){this._cancelFrame&&(this._cancelFrame(),this._cancelFrame=null)}_kickstart(){this._tickMode===2?this._emitter.listenerCount()&&this._request():this._tickMode===3?this._request():this._cancel()}};function P(a){return e=>{let t=a.requestAnimationFrame(e);return()=>a.cancelAnimationFrame(t)}}export{_ as TickMode,h as Ticker,d as createRequestFrame,P as createXrRequestFrame};
