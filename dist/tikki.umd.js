!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("eventti")):"function"==typeof define&&define.amd?define(["exports","eventti"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).tikki={},e.eventti)}(this,(function(e,t){"use strict";function i(e,t=60){if(e)return t=>{const i=e.requestAnimationFrame(t);return()=>{e.cancelAnimationFrame(i)}};if("function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame)return e=>{const t=requestAnimationFrame(e);return()=>{cancelAnimationFrame(t)}};{const e=1e3/t,i="undefined"==typeof performance?()=>Date.now():()=>performance.now();return t=>{const r=setTimeout((()=>t(i())),e);return()=>{clearTimeout(r)}}}}var r;e.AutoTickState=void 0,(r=e.AutoTickState||(e.AutoTickState={}))[r.PAUSED=1]="PAUSED",r[r.ON_DEMAND=2]="ON_DEMAND",r[r.CONTINUOUS=3]="CONTINUOUS";e.Ticker=class{constructor(r={}){const{phases:s=[],autoTick:n=e.AutoTickState.ON_DEMAND,allowDuplicateListeners:o=!0,idDedupeMode:u="replace",requestFrame:a=i()}=r;this.phases=s,this._autoTick=n,this._requestFrame=a,this._cancelFrame=null,this._queue=[],this._emitter=new t.Emitter({allowDuplicateListeners:o,idDedupeMode:u}),this.tick=this.tick.bind(this)}get requestFrame(){return this._requestFrame}set requestFrame(e){this._requestFrame=e,this._kickstart()}get autoTick(){return this._autoTick}set autoTick(e){this._autoTick=e,this._kickstart()}get allowDuplicateListeners(){return this._emitter.allowDuplicateListeners}set allowDuplicateListeners(e){this._emitter.allowDuplicateListeners=e}get idDedupeMode(){return this._emitter.idDedupeMode}set idDedupeMode(e){this._emitter.idDedupeMode=e}tick(...t){this._cancelFrame=null;const{_queue:i}=this;if(i.length)throw new Error("Ticker: Can't tick before the previous tick has finished!");this._request();const{phases:r,_emitter:s}=this;let n,o,u,a,c,h;for(n=0,u=r.length;n<u;n++)h=s._getListeners(r[n]),h&&i.push(h);for(n=0,u=i.length;n<u;n++)for(c=i[n],o=0,a=c.length;o<a;o++)c[o](...t);i.length=0,this._autoTick!==e.AutoTickState.ON_DEMAND||s.listenerCount()||this._cancel()}on(e,t,i){const r=this._emitter.on(e,t,i);return this._request(),r}once(e,t,i){const r=this._emitter.once(e,t,i);return this._request(),r}off(e,t){return this._emitter.off(e,t)}listenerCount(e){return this._emitter.listenerCount(e)}_request(){this._requestFrame&&!this._cancelFrame&&this._autoTick>=e.AutoTickState.ON_DEMAND&&(this._cancelFrame=this._requestFrame(this.tick))}_cancel(){this._cancelFrame&&(this._cancelFrame(),this._cancelFrame=null)}_kickstart(){this._autoTick===e.AutoTickState.ON_DEMAND?this._emitter.listenerCount()&&this._request():this._autoTick===e.AutoTickState.CONTINUOUS?this._request():this._cancel()}},e.createRequestFrame=i,Object.defineProperty(e,"__esModule",{value:!0})}));